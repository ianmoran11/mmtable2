---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# mmtable2

<!-- badges: start -->
<!-- badges: end -->

The goal of mmtable2 is to provide a ggplot2-like interface for untidy tables.
It does this by introducing algabraic untidy tables. 

## Installation

This package is probably too buggy for a smooth installation experience, but feel free to clone and tinker!

## Example

```{r example1, message=FALSE, warning=FALSE, include=FALSE}
library(tibble)
library(gt)
library(tidyverse)
library(gapminder)
library(mmtable2)

```

Here's a couple of GIFs demonstrating how to use mmtable2:

```{r echo=FALSE,  message=FALSE, warning=FALSE, out.width = "800px"}
knitr::include_graphics("https://unpivotr.s3.amazonaws.com/Peek+2021-04-11+15-34.gif")
```

```{r echo=FALSE,  message=FALSE, warning=FALSE, out.width = "800px"}
knitr::include_graphics("https://unpivotr.s3.amazonaws.com/Peek+2021-04-13+12-33.gif")
```

```{r message=FALSE, warning=FALSE, include=FALSE}
# source("./methods/divide_mmtable.R")
# source("./methods/multiply_mmtable_.R")
# source("./methods/plus_mmtable_.R")
# source("./methods/print_mmtable.R")

source("https://raw.githubusercontent.com/ianmoran11/mmtable2/master/methods/divide_mmtable.R")
source("https://raw.githubusercontent.com/ianmoran11/mmtable2/master/methods/multiply_mmtable_.R")
source("https://raw.githubusercontent.com/ianmoran11/mmtable2/master/methods/plus_mmtable_.R")
source("https://raw.githubusercontent.com/ianmoran11/mmtable2/master/methods/print_mmtable.R")
```


```{r, message=FALSE, warning=FALSE, paged.print=FALSE}
student_df
```


```{r, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = "400px"}
table1 <-
  student_df %>%
  mmtable(table_data = value)  +
  header_top(student) +
  header_top_left(grade) +
  header_left(class) +
  header_left_top(subject)

try(table1 %>% gtsave("table1.png"))
```


```{r, message=FALSE, warning=FALSE, paged.print=FALSE}
table1.1 <-
  student_df_1 %>%
  mmtable(table_data = value)  +
  header_top(student) +
  header_top_left(grade) +
  header_left(class) +
  header_left_top(subject)

table2 <-
  student_df_2 %>%
  mmtable(table_data = value)  +
  header_top(student) +
  header_top_left(grade) +
  header_left(class) +
  header_left_top(subject)

```

```{r, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = "400px"}
single_table <- table1 +  table_title("Single Table")  
try(single_table  %>% gtsave("single_table.png"))
```

```{r, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = "400px"}
quotient_table <- table1 / table1.1  +  table_title("Table Quotient")
try(quotient_table  %>% gtsave("quotient_table.png"))
```

```{r, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = "400px"}
product_table <- table1 * table1.1  +  table_title("Table Product") 
try(product_table  %>% gtsave("product_table.png"))
```

```{r, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = "600px"}
sum_table <- table1 + table2    +  table_title("Table Sum")     
try(sum_table  %>% gtsave("sum_table.png"))
```

```{r, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = "600px"}
gapminder_eur <-
  gapminder::gapminder %>%
  filter(continent == "Europe") %>%
  mutate(continent = continent %>% as.character())  %>%
  mutate(country = country %>% as.character())

model_df_list <- map(unique(gapminder_eur$country),possibly(model_lexp,NA), data =gapminder_eur )

model_df <- map(list("Australia"),model_lexp, data = gapminder) %>% .[[1]]
table_list <-  model_df_list[1:10] %>% map(table_model_wide)
```


```{r, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = "600px"}
demo_table <- 
model_df %>%
  mmtable(table_data = value,table_name = "Australia") +
  header_top(statistic) +
  header_top_left(term) +
  header_top_left(statistic_level)

try(demo_table  %>% gtsave("demo_table.png"))
```



```{r, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = "600px"}
one_table <-  table_list[[1]]
try(one_table  %>% gtsave("one_table.png"))
```


```{r, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = "600px"}
two_tables <- table_list[[1]] / table_list[[2]]
try(two_tables  %>% gtsave("two_tables.png"))
```


```{r, message=FALSE, warning=FALSE, paged.print=FALSE, out.width = "600px"}
many_tables <- table_list %>% reduce(`/`)
try(many_tables  %>% gtsave("many_tables.png"))
```










